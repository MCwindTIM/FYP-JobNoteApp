{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ChatListItem from \"../../components/ChatListItem.js\";\nimport AvatarImage from \"../../components/Avatar.js\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { AuthContext } from \"../../components/context\";\nimport io from \"socket.io-client\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function ChatScreen(_ref) {\n  var navigation = _ref.navigation;\n\n  var _React$useContext = React.useContext(AuthContext),\n      getUserData = _React$useContext.getUserData,\n      getAPIServiceURL = _React$useContext.getAPIServiceURL;\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      chats = _React$useState2[0],\n      setChats = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      hasConnection = _React$useState4[0],\n      setConnection = _React$useState4[1];\n\n  var _React$useState5 = React.useState(null),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      lastUpdateTime = _React$useState6[0],\n      setLastUpdateTime = _React$useState6[1];\n\n  var ioEndPoint = getAPIServiceURL() + \"/\";\n  useFocusEffect(React.useCallback(function () {\n    navigation.setOptions({\n      headerTitle: \"Chats\",\n      headerTitleAlign: \"left\",\n      headerLeft: function headerLeft() {\n        return _jsx(View, {\n          style: {\n            marginLeft: 20\n          },\n          children: _jsx(TouchableOpacity, {\n            activeOpacity: 0.5,\n            children: _jsx(AvatarImage, {\n              size: 40,\n              uri: window.CustomVar_avatar\n            })\n          })\n        });\n      }\n    });\n    var socket = io(ioEndPoint, {\n      transports: [\"websocket\"],\n      auth: {\n        _id: getUserData()._id\n      }\n    });\n    socket.io.on(\"open\", function () {\n      return setConnection(true);\n    });\n    socket.io.on(\"close\", function () {\n      return setConnection(false);\n    });\n    socket.on(\"time-msg\", function (data) {});\n    socket.emit(\"getChatRoomData\");\n    socket.on(\"chatRoomData\", function (data) {\n      if (data.success) {\n        setChats(data.data);\n      }\n    });\n    return function () {\n      socket.disconnect();\n      socket.removeAllListeners();\n    };\n  }, []));\n\n  var enterChat = function enterChat(chatRoomData) {\n    navigation.navigate(\"Conversation\", {\n      chatRoomData: chatRoomData\n    });\n  };\n\n  React.useEffect(function () {}, [navigation]);\n  return _jsx(SafeAreaView, {\n    style: {\n      backgroundColor: \"#fff\"\n    },\n    children: _jsx(ScrollView, {\n      style: styles.container,\n      children: chats.map(function (item) {\n        return _jsx(ChatListItem, {\n          id: item._id,\n          chatRoomData: item,\n          enterChat: enterChat\n        }, item._id);\n      })\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    height: \"100%\"\n  }\n});","map":{"version":3,"sources":["D:/VTC files/Github/Assignment/fyp/ReactNative/JobApp/navigation/screens/ChatScreen.js"],"names":["React","ChatListItem","AvatarImage","useFocusEffect","AuthContext","io","ChatScreen","navigation","useContext","getUserData","getAPIServiceURL","useState","chats","setChats","hasConnection","setConnection","lastUpdateTime","setLastUpdateTime","ioEndPoint","useCallback","setOptions","headerTitle","headerTitleAlign","headerLeft","marginLeft","window","CustomVar_avatar","socket","transports","auth","_id","on","data","emit","success","disconnect","removeAllListeners","enterChat","chatRoomData","navigate","useEffect","backgroundColor","styles","container","map","item","StyleSheet","create","height"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    SafeAreaView,\r\n    ScrollView,\r\n    StyleSheet,\r\n    TouchableOpacity,\r\n} from \"react-native\";\r\nimport ChatListItem from \"../../components/ChatListItem.js\";\r\nimport AvatarImage from \"../../components/Avatar.js\";\r\nimport { useFocusEffect } from \"@react-navigation/native\";\r\n\r\nimport { AuthContext } from \"../../components/context\";\r\n//TODO: Ascending order\r\nimport io from \"socket.io-client\";\r\n\r\nexport default function ChatScreen({ navigation }) {\r\n    const { getUserData, getAPIServiceURL } = React.useContext(AuthContext);\r\n    const [chats, setChats] = React.useState([]);\r\n\r\n    const [hasConnection, setConnection] = React.useState(false);\r\n    const [lastUpdateTime, setLastUpdateTime] = React.useState(null);\r\n    const ioEndPoint = `${getAPIServiceURL()}/`;\r\n\r\n    useFocusEffect(\r\n        React.useCallback(() => {\r\n            navigation.setOptions({\r\n                headerTitle: \"Chats\",\r\n                headerTitleAlign: \"left\",\r\n                headerLeft: () => (\r\n                    <View style={{ marginLeft: 20 }}>\r\n                        <TouchableOpacity activeOpacity={0.5}>\r\n                            <AvatarImage\r\n                                size={40}\r\n                                uri={window.CustomVar_avatar}\r\n                            ></AvatarImage>\r\n                        </TouchableOpacity>\r\n                    </View>\r\n                ),\r\n            });\r\n            const socket = io(ioEndPoint, {\r\n                transports: [\"websocket\"],\r\n                auth: {\r\n                    _id: getUserData()._id,\r\n                },\r\n            });\r\n            socket.io.on(\"open\", () => setConnection(true));\r\n            socket.io.on(\"close\", () => setConnection(false));\r\n            socket.on(\"time-msg\", (data) => {\r\n                // debug\r\n                // console.log(new Date(data.time).toString());\r\n                // setLastUpdateTime(data.time);\r\n            });\r\n            socket.emit(\"getChatRoomData\");\r\n            socket.on(\"chatRoomData\", (data) => {\r\n                if (data.success) {\r\n                    setChats(data.data);\r\n                }\r\n            });\r\n            return () => {\r\n                //on unFocus\r\n                socket.disconnect();\r\n                socket.removeAllListeners();\r\n            };\r\n        }, [])\r\n    );\r\n\r\n    const enterChat = (chatRoomData) => {\r\n        navigation.navigate(\"Conversation\", {\r\n            chatRoomData: chatRoomData,\r\n        });\r\n    };\r\n\r\n    React.useEffect(() => {}, [navigation]);\r\n\r\n    return (\r\n        <SafeAreaView style={{ backgroundColor: \"#fff\" }}>\r\n            <ScrollView style={styles.container}>\r\n                {chats.map((item) => (\r\n                    <ChatListItem\r\n                        id={item._id}\r\n                        chatRoomData={item}\r\n                        key={item._id}\r\n                        enterChat={enterChat}\r\n                    ></ChatListItem>\r\n                ))}\r\n                {/* <ChatListItem /> */}\r\n            </ScrollView>\r\n        </SafeAreaView>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        height: \"100%\",\r\n    },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}